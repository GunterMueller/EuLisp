###-----------------------------------------------------------------------------
### ---                   EuLisp System 'youtoo'
###-----------------------------------------------------------------------------

###-----------------------------------------------------------------------------
### EuLisp Vmeta library Makefile
###-----------------------------------------------------------------------------
ARCH := $(shell uname -m)
include ../../Lib.$(ARCH)/Makefile

###-----------------------------------------------------------------------------
### Syntax Module name
###-----------------------------------------------------------------------------
SYNTAX_MODULE = vmeta

###-----------------------------------------------------------------------------
### Syntax Library target files
###-----------------------------------------------------------------------------
SYNTAX_MODULE_LIB_I = $(U2_C_DIR)/$(SYNTAX_MODULE).i

###-----------------------------------------------------------------------------
### Source files
###-----------------------------------------------------------------------------
SYNTAX_MODULE_EM = $(SYNTAX_MODULE).em
MACROS_EM = vmeta-aux.em

###-----------------------------------------------------------------------------
### Test source files
###-----------------------------------------------------------------------------
TEST_EM = test-vmeta.em
TEST_EXE = $(TEST_EM:%.em=$(ARCH_DIR)/%)

###-----------------------------------------------------------------------------
### Build library
###-----------------------------------------------------------------------------
.PHONY: lib
lib: $(SYNTAX_MODULE_LIB_I)

$(U2_C_DIR)/%.i : %.em
	${U2} -c ${U2FLAGS} $< -l level-0

###-----------------------------------------------------------------------------
### Test
###-----------------------------------------------------------------------------
$(ARCH_DIR)/% : %.em $(SYNTAX_MODULE_LIB_I) | $(ARCH_DIR)/.
	$(U2) $(U2FLAGS) $< --object-dir $(ARCH_DIR) -l level-0

.PHONY: test
test: $(TEST_EXE)
	$(TEST_EXE)

###-----------------------------------------------------------------------------
.PHONY: README
README: README.html

.PHONY: clean
clean:
	@rm -rf $(ARCH_DIR)

.PHONY: distclean
distclean: clean
	@rm -rf platforms $(U2_C_DIR)

###-----------------------------------------------------------------------------
