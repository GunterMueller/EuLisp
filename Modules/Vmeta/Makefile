###-----------------------------------------------------------------------------
### ---                   EuLisp System 'youtoo'
###-----------------------------------------------------------------------------

###-----------------------------------------------------------------------------
### EuLisp Vmeta library Makefile
###-----------------------------------------------------------------------------

ARCH := $(shell uname -m)
include ../../Lib.$(ARCH)/Makefile

###-----------------------------------------------------------------------------
### Syntax Module name
###-----------------------------------------------------------------------------

SYNTAX_MODULE = vmeta

###-----------------------------------------------------------------------------
### Syntax Library target files
###-----------------------------------------------------------------------------

SYNTAX_MODULE_LIB_I = $(SYNTAX_MODULE).i

###-----------------------------------------------------------------------------
### Source files
###-----------------------------------------------------------------------------

SYNTAX_MODULE_EM = $(SYNTAX_MODULE).em
MACROS_EM = vmeta-aux.em

###-----------------------------------------------------------------------------
### Test source files
###-----------------------------------------------------------------------------

TEST_EM = test-vmeta.em
TEST_EXE = $(TEST_EM:%.em=$(ARCH_DIR)/%)

###-----------------------------------------------------------------------------
### Build library
###-----------------------------------------------------------------------------

.PHONY: lib
lib: $(SYNTAX_MODULE_LIB_I)

%.i : %.em
	${U2} -c ${U2FLAGS} $< -l level1

###-----------------------------------------------------------------------------
### Test
###-----------------------------------------------------------------------------

$(ARCH_DIR)/% : %.em $(SYNTAX_MODULE_LIB_I) | $(ARCH_DIR)/.
	$(U2) $(U2FLAGS) $< -od $(ARCH_DIR) -l level1

.PHONY: test
test: $(TEST_EXE)
	$(TEST_EXE)

###-----------------------------------------------------------------------------

.PHONY: README
README: README.html

.PHONY: clean
clean:
	@rm -rf $(ARCH_DIR)
	@rm -f *.{i,c,h} *_.{i,c,h}

.PHONY: distclean
distclean: clean
	@rm -rf platforms

###-----------------------------------------------------------------------------
